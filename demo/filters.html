<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="./assets/css/style.css">
    <title>HTML GL filters demo</title>
    <meta name="viewport" content="width=1024 maximum-scale=1.0 minimum-scale=1.0 initial-scale=1.0, user-scalable=no" />
</head>
<body>
<div class="content_wrapper">
    <h1>MENU RENDERED IN DOM</h1>
    <nav class="top_nav">
        <ul class="menu expanded">
            <li><a target="_blank" href="http://pixelscommander.com/en/web-applications-performance/render-html-css-in-webgl-to-get-highest-performance-possibl/">ABOUT HTML-GL</a></li>
            <li><a target="_blank" href="https://github.com/PixelsCommander/HTML-GL">GITHUB REPO</a></li>
        </ul>
        <ul class="submenu">
            <li><a target="_blank" href="https://github.com/PixelsCommander/HTML-GL/archive/master.zip">DOWNLOAD</a></li>
            <li>
                <!-- AddThis Button BEGIN -->
                <div class="addthis_toolbox addthis_default_style">
                    <iframe style="display: inline-block;"
                            src="http://ghbtns.com/github-btn.html?user=PixelsCommander&repo=HTML-GL&type=watch"
                            allowtransparency="true" frameborder="0" scrolling="0" width="62" height="20"></iframe>
                    <a class="addthis_button_tweet"></a>
                    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
                </div>
                <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
                <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4ea2f9164143bcfb"></script>
                <!-- AddThis Button END -->
            </li>
        </ul>
    </nav>
    <section class="broadcasts_list">
        <h1>SLIDER BELOW IS RENDERED IN WEBGL, DRAG IT</h1>
        <html-gl class="horizontal_carusel">
            <li class="broadcast" onclick="alert('Clicked Argo')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_argo.png" width="186px" height="270px">

                <p>
                    Select me with DevTools
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>7.8<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Clicked Avatar')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_avatar.png" width="186px" height="270px">

                <p>
                    Change me in DevTools
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>8.0<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Clicked Breaking Bad')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_breaking_bad.png" width="186px" height="270px">

                <p>
                    Breaking bad
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>9.6<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Quantum of solace')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_quantum_of_solace.png" width="186px" height="270px">

                <p>
                    Quantum of solace
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>6.7<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Quantum of solace')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_quantum_of_solace.png" width="186px" height="270px">

                <p>
                    Quantum of solace
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>7.4<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Quantum of solace')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_quantum_of_solace.png" width="186px" height="270px">

                <p>
                    Quantum of solace
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>7.4<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Quantum of solace')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_quantum_of_solace.png" width="186px" height="270px">

                <p>
                    Quantum of solace
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>7.4<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Quantum of solace')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_quantum_of_solace.png" width="186px" height="270px">

                <p>
                    Quantum of solace
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>7.4<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Quantum of solace')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_quantum_of_solace.png" width="186px" height="270px">

                <p>
                    Quantum of solace
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>7.4<span>/10</span></span>
                </p>
            </li>
            <li class="broadcast" onclick="alert('Quantum of solace')">
                <div class="image_background"></div>
                <img src="./pic/boxes/box_quantum_of_solace.png" width="186px" height="270px">

                <p>
                    Quantum of solace
                </p>

                <p>
                    <img src="./assets/img/imdb.png" width="52px" height="24px">
                    <span>7.4<span>/10</span></span>
                </p>
            </li>
            <div class="">

            </div>
        </html-gl>
    </section>
</div>

<script src="../bower_components/promise-polyfill/Promise.min.js"></script>
<script src="../bower_components/webcomponents.js/CustomElements.min.js"></script>
<script src="./js/vendor/velocity.js"></script>
<script src="./js/vendor/html2canvas.js"></script>
<script src="../bower_components/pixi/bin/pixi.js"></script>
<script src="../src/util.js"></script>
<script src="../src/gl-element-resolver.js"></script>
<script src="../src/gl-context.js"></script>
<script src="../src/images-loaded.js"></script>
<script src="../src/gl-element.js"></script>
<script src="./js/slider.js"></script>
<script src="./js/vendor/dat.gui.min.js"></script>
<script>

    var renderer = window.HTMLGL.renderer;

    var filtersSwitchs = [true, false, false, false, false, false, false, false, false, false, false];

    var gui = new dat.GUI({});



    var displacementSprite = new PIXI.TilingSprite.fromImage("assets/img/displacement_map.jpg");
    window.HTMLGL.stage.addChild(displacementSprite);
    var displacementFilter = new PIXI.filters.DisplacementFilter(displacementSprite);

    var displacementFolder = gui.addFolder('Displacement');
    displacementFolder.add(filtersSwitchs, '0').name("apply");
    displacementFolder.add(displacementFilter.scale, 'x', 1, 200).name("scaleX");
    displacementFolder.add(displacementFilter.scale, 'y', 1, 200).name("scaleY");
    displacementFolder.open();

    var blurFilter = new PIXI.filters.BlurFilter();

    var blurFolder = gui.addFolder('Blur');
    blurFolder.add(filtersSwitchs, '1').name("apply");
    blurFolder.add(blurFilter, 'blurX', 0, 32).name("blurX");
    blurFolder.add(blurFilter, 'blurY', 0, 32).name("blurY");

    ////

    var pixelateFilter = new PIXI.filters.PixelateFilter();

    var pixelateFolder = gui.addFolder('Pixelate');
    pixelateFolder.add(filtersSwitchs, '2').name("apply");
    pixelateFolder.add(pixelateFilter.size, 'x', 1, 32).name("PixelSizeX");
    pixelateFolder.add(pixelateFilter.size, 'y', 1, 32).name("PixelSizeY");

    ////

    var invertFilter = new PIXI.filters.InvertFilter();

    var invertFolder = gui.addFolder('Invert');
    invertFolder.add(filtersSwitchs, '3').name("apply");
    invertFolder.add(invertFilter, 'invert', 0, 1).name("Invert");

    ////

    var grayFilter = new PIXI.filters.GrayFilter();

    var grayFolder = gui.addFolder('Gray');
    grayFolder.add(filtersSwitchs, '4').name("apply");
    grayFolder.add(grayFilter, 'gray', 0, 1).name("Gray");

    ////

    var sepiaFilter = new PIXI.filters.SepiaFilter();

    var sepiaFolder = gui.addFolder('Sepia');
    sepiaFolder.add(filtersSwitchs, '5').name("apply");
    sepiaFolder.add(sepiaFilter, 'sepia', 0, 1).name("Sepia");

    ////

    var twistFilter = new PIXI.filters.TwistFilter();

    var twistFolder = gui.addFolder('Twist');
    twistFolder.add(filtersSwitchs, '6').name("apply");
    twistFolder.add(twistFilter, 'angle', 0, 10).name("Angle");
    twistFolder.add(twistFilter, 'radius', 0, 1).name("Radius");

    twistFolder.add(twistFilter.offset, 'x', 0, 1).name("offset.x");;
    twistFolder.add(twistFilter.offset, 'y', 0, 1).name("offset.y");;

    ////

    var dotScreenFilter = new PIXI.filters.DotScreenFilter();

    var dotScreenFolder = gui.addFolder('DotScreen');
    dotScreenFolder.add(filtersSwitchs, '7').name("apply");
    dotScreenFolder.add(dotScreenFilter, 'angle', 0, 10);
    dotScreenFolder.add(dotScreenFilter, 'scale', 0, 1);

    ////

    var colorStepFilter = new PIXI.filters.ColorStepFilter();

    var colorStepFolder = gui.addFolder('ColorStep');
    colorStepFolder.add(filtersSwitchs, '8').name("apply");

    colorStepFolder.add(colorStepFilter, 'step', 1, 100);
    colorStepFolder.add(colorStepFilter, 'step', 1, 100);

    ////

    var crossHatchFilter = new PIXI.filters.CrossHatchFilter();

    var crossHatchFolder = gui.addFolder('CrossHatch');
    crossHatchFolder.add(filtersSwitchs, '9').name("apply");

    var rgbSplitterFilter = new PIXI.filters.RGBSplitFilter();

    rgbSplitterFilter.blue = new PIXI.Point(10, 10);
    rgbSplitterFilter.green = new PIXI.Point(-10, 10);
    rgbSplitterFilter.red = new PIXI.Point(10, -10);

    var rgbSplitFolder = gui.addFolder('RGB Splitter');
    rgbSplitFolder.add(filtersSwitchs, '10').name("apply");


    var filterCollection = [displacementFilter, blurFilter, pixelateFilter, invertFilter, grayFilter, sepiaFilter, twistFilter, dotScreenFilter, colorStepFilter, crossHatchFilter, rgbSplitterFilter];

    // create an new instance of a pixi stage
    var stage = window.HTMLGL.stage;

    var pondContainer = window.HTMLGL.document;
    stage.addChild(pondContainer);

    stage.interactive = true;

    var padding = 100;
    var bounds = new PIXI.Rectangle(-padding, -padding, window.HTMLGL.renderer.width + padding * 2, window.HTMLGL.renderer.height + padding * 2)

    var overlay = new PIXI.TilingSprite(PIXI.Texture.fromImage("assets/img/zeldaWaves.png"), window.HTMLGL.renderer.width, window.HTMLGL.renderer.height);
    overlay.alpha = 0.1//0.2
    pondContainer.addChild(overlay);

    displacementFilter.scale.x = 50;
    displacementFilter.scale.y = 50;

    var count = 0;
    var switchy = false;

    function animate() {

        count += 0.1;

        var blurAmount = Math.cos(count) ;
        var blurAmount2 = Math.sin(count * 0.8)  ;

        var filtersToApply = [];

        filtersSwitchs[0] ? overlay.visible = true : overlay.visible = false;

        for (var i = 0; i < filterCollection.length; i++) {
            if(filtersSwitchs[i])filtersToApply.push(filterCollection[i]);
        };

        var rgbFilterIndex = filtersToApply.indexOf(rgbSplitterFilter);

        if (rgbFilterIndex !== -1) {
            HTMLGL.elements[0].sprite.filters = [rgbSplitterFilter];
            filtersToApply.splice(rgbFilterIndex, 1);
        } else {
            if (HTMLGL.elements[0].sprite.filters) {
                var rgbFilterIndexOnSlider = HTMLGL.elements[0].sprite.filters.indexOf(rgbSplitterFilter);
                if (rgbFilterIndexOnSlider !== -1) {
                    HTMLGL.elements[0].sprite.filters = null;
                }
            }
        }

        pondContainer.filters = filtersToApply.length > 0 ? filtersToApply : null;

        displacementSprite.x = count * 10;
        displacementSprite.y = count * 10;

        overlay.tilePosition.x = count * -10;
        overlay.tilePosition.y = count * -10;

        renderer.render(stage);
        requestAnimationFrame( animate );
    }

    renderer.render(stage);
    requestAnimationFrame( animate );

</script>
</body>
</html>